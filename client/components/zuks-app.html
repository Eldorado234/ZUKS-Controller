<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-dialog/paper-action-dialog.html">
<link rel="import" href="../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/core-pages/core-pages.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/core-icons/social-icons.html">

<link rel="import" href="zuks-service/zuks-service.html">
<link rel="import" href="zuks-map.html">
<link rel="import" href="zuks-volunteer-list.html">
<link rel="import" href="zuks-group-list.html">
<link rel="import" href="zuks-poi-list.html">

<polymer-element name="zuks-app">
  <template>
    <style>
    :host {
      
    }

    .container {
      height: 100%;
      background-color: #fff;
    }

    paper-tabs::shadow #selectionBar {
      background-color: #ec7217;
    }
    paper-tabs paper-tab::shadow #ink {
      color: #ec7217;
    }
     
    paper-tabs, core-toolbar {
      width: 300px;
      background-color: #4d9eff;
      color: white;
    }

    paper-tabs {
      font-weight: 800;
    }
    </style>
    
    <zuks-service volunteers="{{volunteers}}" volunteerGroups="{{volunteerGroups}}" pois="{{pois}}" poiCategories="{{poiCategories}}" id="service"></zuks-service>
    
    <div class="container" layout horizontal>
      <zuks-map flex id="map" volunteers="{{volunteers}}" on-volunteer-added="{{volunteerAdded}}" selectedVolunteers="{{selectedVolunteers}}" on-volunteer-select="{{volunteerSelected}}" pois="{{pois}}" poiCategories="{{poiCategories}}" selectedPOI="{{selectedPOI}}" on-poi-select="{{poiSelected}}"></zuks-map>
      
      <div vertical layout>
        <core-toolbar>
          <div flex>ZUKS</div>
          <!-- use `group-add` icon -->
          <paper-icon-button icon="social:group-add" on-tap="{{createGroup}}"></paper-icon-button>
          <paper-icon-button icon="add" on-tap="{{createPOI}}"></paper-icon-button>
        </core-toolbar>
        <paper-tabs selected="{{selectedTab}}">
          <paper-tab>
            Helfer
          </paper-tab>
          <paper-tab>
            Gruppen
          </paper-tab>
          <paper-tab>
            Orte
          </paper-tab>
        </paper-tabs>
        
        <core-pages selected="{{selectedTab}}" flex>
          <zuks-volunteer-list volunteerGroups="{{volunteerGroups}}" on-group-added="{{groupAdded}}" 
          on-group-updated="{{groupUpdated}}" on-volunteers-updated="{{volunteersUpdated}}" 
          on-volunteer-selected="{{volunteerSelected}}" selectedVolunteers="{{selectedVolunteers}}" id="list"></zuks-volunteer-list>
          <zuks-group-list volunteerGroups="{{volunteerGroups}}" on-group-added="{{groupAdded}}" 
          on-group-updated="{{groupUpdated}}" id="groupList"></zuks-group-list>
          <zuks-poi-list poiCategories="{{poiCategories}}" selectedPOI="{{selectedPOI}}" on-poi-create="{{poiCreated}}" 
          on-poi-update="{{poiUpdated}}" id="poiList"></zuks-group-list>
        </core-pages>
      </div>
    </div>

    <paper-action-dialog heading="Freiwilligen hinzufÃ¼gen" id="addVolunteer" backdrop="true">
        <paper-input-decorator label="Vorname">
          <input is="core-input" value="{{volunteer.first_name}}" autofocus />
        </paper-input-decorator>
        <paper-input-decorator label="Nachname">
          <input is="core-input" value="{{volunteer.last_name}}" />
        </paper-input-decorator>

        <paper-button affirmative>Abbrechen</paper-button>
        <paper-button affirmative on-click="{{saveVolunteer}}">Speichern</paper-button>
    </paper-action-dialog>
    

  </template>
  <script>
  Polymer({
    ready: function() {
      this.selectedTab = 0;
      CoreStyle.g.paperInput.focusedColor = '#4d9eff';
    },
    volunteerAdded: function(volunteerLocation) {
      this.volunteer = {
        first_name: "",
        last_name: "",
        location: volunteerLocation.detail,
        group: 1
      }
      this.$.addVolunteer.open();
    },
    saveVolunteer: function() {
      this.$.service.addVolunteer(this.volunteer);
    },
    groupAdded: function(event) {
      this.$.service.addGroup(event.detail);
    },
    groupUpdated: function(event) {
      this.$.service.updateGroup(event.detail);
    },
    volunteersUpdated: function(event) {
      var self = this;
      $(event.detail).each(function() {
        self.$.service.updateVolunteer(this);
      });
    },
    volunteerSelected: function(event) {
      this.$.list.selectVolunteer(event.detail);
    },
    createGroup: function() {
      this.$.groupList.addGroup();
    },
    poiCreated: function(event) {
      this.$.service.addPOI(event.detail);
    },
    poiUpdated: function(event) {
      this.$.service.updatePOI(event.detail);
    },
    createPOI: function() {
      this.$.poiList.createPOI();
    },
    poiSelected: function(event) {
      this.$.poiList.selectPOI(event.detail);
    }
  });
  </script>
</polymer-element>
