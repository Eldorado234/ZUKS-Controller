<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/leaflet-map/leaflet-map.html">
<link rel="import" href="../bower_components/core-list/core-list.html">
<link rel="import" href="../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/core-overlay/core-overlay.html">

<polymer-element name="zuks-volunteer-list" attributes="volunteerGroups">
  <template>
    <style>
    :host {
      display: block;
      height: 100%;
      overflow: scroll;
    }

    core-list {
      height: calc(100% - 60px);
      width: 300px;
      
    }

    .item {
      height: 70px;
      padding-right: 20px;
      padding-left: 20px;
      padding-top: 5px;
      padding-bottom: 5px;
    }

    .container, paper-shadow {
      height: 100%;
    }

    .divider {
      color: #888;
      padding-left: 20px;
      padding-top: 15px;
    }

    .content {
      padding-left: 10px;
    }

    .devider paper-button {
      margin:0;
    }

    </style>

    <paper-button raised on-click="{{addGroup}}">Neue Gruppe</paper-button>

    <core-list data="{{volunteerGroups | flattenGroup}}" groups="{{volunteerGroups}}" height="70" >
      <template>
        <div divider class="divider"><paper-button on-click="{{updateGroup}}">{{groupModel.name}}</paper-button></div>
        <div class="item" on-click="{{showVolunteerDetails}}">
          <paper-shadow>
            <div horizontal layout center class="container">
            <div class="content">{{model.first_name}} {{model.last_name}}</div>
          </div>
          <paper-ripple fit></paper-ripple>
          </paper-shadow>
        </div>
      </template>
    </core-list>

    <paper-action-dialog heading="Gruppe {{actionName}}" id="addGroup" backdrop="true">
        <paper-input-decorator label="Name">
          <input is="core-input" value="{{group.name}}" autofocus />
        </paper-input-decorator>

        <paper-button dismissive>Abbrechen</paper-button>
        <paper-button affirmative default on-click="{{saveGroup}}">Speichern</paper-button>
    </paper-action-dialog>

    <paper-action-dialog heading="{{volunteer.first_name}} {{volunteer.last_name}}" id="volunteerDetail" autoCloseDisabled="true">
        <paper-dropdown-menu label="Gruppe">
            <paper-dropdown layered class="dropdown">
                <core-menu class="menu" valueattr="id" selected="{{volunteer.group}}">
                    <template repeat="{{group in volunteerGroups}}">
                        <paper-item>{{group.name}}</paper-item>
                    </template>
                </core-menu>
            </paper-dropdown>
        </paper-dropdown-menu>

        <paper-button affirmative>Abbrechen</paper-button>
        <paper-button affirmative on-click="{{saveVolunteer}}">Speichern</paper-button>
    </paper-action-dialog>

  </template>
  <script>
  Polymer({
    flattenGroup: function(groupList) {
      var volunteers = [];
      $(groupList).each(function() {
        volunteers.push(this.members);
      });
      return volunteers;
    },
    addGroup: function() {
      this.group = {name: "", members: []};
      this.actionName = "hinzuf√ºgen";
      this.$.addGroup.open();
    },
    updateGroup: function(event) {
      this.group = $.extend(true, {}, event.target.templateInstance.model.groupModel);
      this.actionName = "aktualisieren";
      this.$.addGroup.open();
    },
    saveGroup: function() {
      if (this.group.id) {
        this.fire("group-updated", this.group);
      } else {
        this.fire("group-added", this.group);
      }
    },
    showVolunteerDetails: function(event) {
      this.showVolunteer(event.target.templateInstance.model.model);
    },
    showVolunteer: function(volunteer) {
      this.volunteer = $.extend(true, {}, volunteer);
      this.$.volunteerDetail.open();
      this.fire("volunteer-selected", this.volunteer);
    },
    saveVolunteer: function(event) {
      this.fire("volunteer-updated", this.volunteer);
    }
  });
  </script>
</polymer-element>
